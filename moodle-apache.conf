<Directory /var/www/html/moodle/public>
    AllowOverride None
    Require all granted
</Directory>

RewriteEngine On
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://%{SERVER_NAME}/$1 [R,L]

# Set HTTPS environment variable based on X-Forwarded-Proto header
SetEnvIf X-Forwarded-Proto "https" HTTPS=on